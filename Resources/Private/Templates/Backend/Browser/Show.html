<!DOCTYPE html>
<html lang="en" style="height:100%;width:100%">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>AdmiralCloud Embed</title>
</head>
<body style="height:100%;width:100%">
<div id="images"></div>
<div id="admiralcloud-browser"
    data-irreObject="{parameters.irreObject}">
</div>
<iframe src="{iframeUrl}" style="width:100%;height:100%"></iframe>
<script>
    window.onmessage = function (e) {
        var data = JSON.parse(e.data);

        // Receive Media
        if (data.command === 'MEDIA') {
            console.log('MEDIA', data);
            const isInsertAllowed = true;
            console.log('INSERT?', isInsertAllowed);

            var parentDocument = parent.document,
                contentIframe = parent.document.getElementById('typo3-contentIframe');

            if (contentIframe) {
                parentDocument = contentIframe.contentDocument;
            }

            // Dispatch internal interaction for TYPO3/CMS/AdmiralcloudConnector/Browser
            var target = document.getElementById('admiralcloud-browser').getAttribute('data-irreObject');
            var event, parameters = {
                detail: {
                    target: target,
                    media: data
                }
            };

            if (typeof CustomEvent === 'function') {
                event = new CustomEvent('AdmiralcloudBrowserAddMedia', parameters);
            } else {
                // Add IE11 support
                event = document.createEvent('CustomEvent');
                event.initCustomEvent('AdmiralcloudBrowserAddMedia', true, true, parameters);
            }

            parentDocument.dispatchEvent(event);
        }
    };
</script>
</body>
</html>
